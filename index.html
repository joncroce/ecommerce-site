<!DOCTYPE html>

<html lang="en">

<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<meta name="description"
		content="Demo using native browser tech of a hierarchical menu displaying products by collapsible categories with &quot;add to favorites&quot; functionality." />
	<meta name="og:title" content="E-Commerce Site" />
	<meta name="og:description"
		content="Demo using native browser tech of a hierarchical menu displaying products by collapsible categories with &quot;add to favorites&quot; functionality." />
	<meta name="og:url" content="https://joncroce.github.io/ecommerce-site/" />
	<meta name="og:image" content="https://joncroce.github.io/ecommerce-site/favicon.png" />

	<link rel="icon" type="image/png" href="favicon.png" />

	<title>E-Commerce Site</title>

	<style>
		/* Reset */

		*,
		*::before,
		*::after {
			box-sizing: border-box;
		}

		body {
			margin: 0;
		}

		h2,
		h3,
		h4 {
			margin: 0;
		}

		ul {
			padding: 0;
			list-style: none;
		}

		/* Headings */

		h2 {
			font-size: 3rem;
		}

		h3 {
			font-size: 1.8rem;
		}

		h4 {
			font-size: 1.2rem;
		}

		/* Header */

		.page-header {
			margin-block: 1em;
			display: grid;
			grid-template-columns: 1em auto 1em;
			gap: 1rem;
			font-size: 3rem;
		}

		.logo {
			grid-column: span 1;
			display: grid;
			place-items: center;
		}

		.logo__image {
			width: 100%;
			aspect-ratio: 1;
		}

		.logo__image--reverse {
			width: 100%;
			aspect-ratio: 1;
			transform: scaleX(-1);
		}

		/* Main */

		body,
		main,
		#container {
			display: grid;
			place-items: center;
			width: 100%;
		}

		.category__button:focus-visible,
		.product__button:focus-visible {
			outline: 2px solid hotpink;
			outline-offset: -3px;
		}

		.category-list {
			width: clamp(320px, 100%, 640px);
			display: grid;
			grid-auto-rows: auto;
			gap: 2px;
			border: 2px solid #333;
			background-color: #333;
		}

		.category__button {
			width: 100%;
			padding: 0;
			display: grid;
			grid-auto-rows: auto;
			gap: 1px;
			background-color: #777;
			cursor: pointer;
			border: none;
		}

		.category-list__category[aria-expanded="false"] .category__header::after {
			/* Unicode Character BLACK UP-POINTING TRIANGLE */
			content: ' \25B2';
		}

		.category-list__category[aria-expanded="true"] .category__header::after {
			/* Unicode Character BLACK DOWN-POINTING TRIANGLE */
			content: ' \25BC';
		}

		.category-list__category[aria-expanded="false"] .product-list {
			display: none;
		}

		.category__header {
			padding-block: 0.5rem;
			font-weight: 600;
			text-align: center;
			background-color: #DDD;
		}

		.product-list {
			display: grid;
			grid-auto-rows: auto;
			gap: 1px;
			background-color: #999;
		}

		.product__button {
			width: 100%;
			padding: 0.5rem 0.25rem;
			cursor: pointer;
			display: grid;
			grid-template-columns: 2rem auto;
			gap: 1px;
			background-color: #FFF;
			border: none;
		}

		.product__button:hover .price__value--sale-price,
		.product__button:focus-visible .price__value--sale-price {
			visibility: visible;
		}

		.product__button:hover .price__value--list-price,
		.product__button:focus-visible .price__value--list-price {
			text-decoration: line-through;
			color: red;
		}

		.product__button:hover .heart-outer,
		.product__button:focus-visible .heart-outer {
			fill: red;
		}

		.product-list__product[data-favorited="true"] .heart-outer {
			fill: darkred;
		}

		.product-list__product[data-favorited="true"] .heart-inner {
			opacity: 1;
			fill: red;
		}

		.heart-inner {
			opacity: 0;
		}

		.product__favorited {
			grid-column: 1 / span 1;
			font-size: 1.2rem;
		}

		.product__header {
			grid-column: 2 / span 1;
			text-align: left;
		}

		.product__price {
			grid-column: 2 / span 1;
			font-size: 1.1rem;
			text-align: left;
		}

		.price__label {
			color: #333;
		}

		.price__value {
			font-family: monospace;
		}

		.price__value--sale-price {
			padding-inline: 0.5em;
			visibility: hidden;
			color: green;
		}

		/* Footer */

		footer {
			position: fixed;
			bottom: 0;
			width: 100%;
			padding: 0.25em 0.5em;
			font-family: monospace;
			text-align: end;
		}
	</style>
</head>

<body>
	<header class="page-header">
		<div class="logo">
			<img class="logo__image" src="favicon.png" alt="Logo showing a heart shape inside a shopping cart." />
		</div>
		<h2>E-Commerce Site</h2>
		<div class="logo">
			<img class="logo__image--reverse" src="favicon.png" alt="Logo showing a heart shape inside a shopping cart." />
		</div>
	</header>

	<main>
		<section id="container">
		</section>
	</main>

	<footer>
		Â© 2023 Jon Croce [<a href="https://github.com/joncroce/ecommerce-site">Source Repo</a>]
	</footer>

	<noscript>Please enable JavaScript to view this site.</noscript>

	<script>
		(async () => {
			const productsData = await fetchProducts();

			const linkedDataJson = createLinkedDataJson(productsData);
			insertLinkedDataScript(linkedDataJson);

			const containerEl = document.getElementById('container');
			buildInventoryAndAppendToContainer(productsData, containerEl);
		})();

		function buildInventoryAndAppendToContainer(productsData, containerEl) {
			const productsByCategory = groupProductsByCategory(productsData);
			const categoryListEl = createCategoryListEl();
			productsByCategory.forEach((products, category) =>
				buildCategoryAndAppendToList(products, category, categoryListEl)
			);
			containerEl.appendChild(categoryListEl);
		}

		async function fetchProducts() {
			const url = 'https://neodigm.github.io/FED_Programming_Challenge/products.json';
			let data = [];
			try {
				await fetch(url)
					.then(res => { data = res.json() });
			} catch (e) {
				console.error(e?.message ?? 'Error retrieving product data.');
			}

			return data;
		}

		function createLinkedDataJson(productsData = []) {
			return {
				"@context": "http://schema.org",
				"@type": "ItemList",
				"url": document.documentURI,
				"numberOfItems": productsData.length,
				"itemListElement": productsData.map((productData) => {
					const { cat, product, price, sale } = productData;
					return {
						"@type": "Product",
						"name": product,
						"category": cat,
						"Offers": [
							{
								"@type": "Offer",
								"description": "Regular Price",
								"priceSpecification": {
									"@type": "PriceSpecification",
									"priceCurrency": "USD",
									"price": price
								},
							},
							{
								"@type": "Offer",
								"description": "Sale Price",
								"priceSpecification": {
									"@type": "PriceSpecification",
									"priceCurrency": "USD",
									"price": sale
								}
							}
						],
					}
				})
			}
		}

		function insertLinkedDataScript(json) {
			const scriptEl = document.createElement('script');
			scriptEl.type = 'application/ld+json';
			scriptEl.text = JSON.stringify(json);

			document.querySelector('head').appendChild(scriptEl);
		}

		function groupProductsByCategory(productsData = []) {
			const productsByCategory = new Map();

			productsData.forEach((productData) => {
				const category = productData.cat;
				const name = productData.product;
				const price = parseFloat(productData.price);
				const salePrice = parseFloat(productData.sale);
				const id = `${category}_${name}`;

				const product = { id, name, price, salePrice };

				if (productsByCategory.has(category)) {
					productsByCategory.set(category, [...productsByCategory.get(category), product])
				} else {
					productsByCategory.set(category, [product]);
				}
			});

			return productsByCategory;
		}

		function createCategoryListEl() {
			const categoryListEl = document.createElement('ul');
			categoryListEl.classList.add('category-list');
			categoryListEl.setAttribute('aria-label', 'Product Categories');

			return categoryListEl;
		}

		function createCategoryListItemEl() {
			const categoryListItemEl = document.createElement('li');
			categoryListItemEl.classList.add('category-list__category');
			categoryListItemEl.setAttribute('aria-expanded', 'false');

			return categoryListItemEl;
		}

		function createCategoryButtonEl() {
			const categoryButtonEl = document.createElement('button');
			categoryButtonEl.classList.add('category__button');
			categoryButtonEl.setAttribute('type', 'button');
			categoryButtonEl.addEventListener('click', categoryClickHandler);

			return categoryButtonEl;
		}

		function createCategoryHeaderEl(categoryName) {
			const categoryHeaderEl = document.createElement('h3');
			categoryHeaderEl.classList.add('category__header');
			categoryHeaderEl.innerText = categoryName;

			return categoryHeaderEl;
		}

		function createProductListEl(categoryName) {
			const productListEl = document.createElement('ul');
			productListEl.classList.add('product-list');
			productListEl.setAttribute('aria-label', `Products in category: ${categoryName}`)

			return productListEl;
		}

		function createProductListItemEl(id, isFavorited = false) {
			const productListItemEl = document.createElement('li');
			productListItemEl.classList.add('product-list__product');
			productListItemEl.setAttribute('data-id', id);
			productListItemEl.setAttribute('data-favorited', isFavorited);

			return productListItemEl;
		}

		function createProductButtonEl() {
			const productButtonEl = document.createElement('button');
			productButtonEl.classList.add('product__button');
			productButtonEl.setAttribute('type', 'button');
			productButtonEl.addEventListener('click', productClickHandler);

			return productButtonEl;
		}

		function createProductHeaderEl(productName) {
			const productHeaderEl = document.createElement('h4');
			productHeaderEl.classList.add('product__header');
			productHeaderEl.innerText = productName;
			return productHeaderEl;
		}

		function createProductFavoriteEl() {
			/**
			 * Using icon ph:heart-straight-duotone from the Phosphor collection
			 * https://github.com/phosphor-icons/web
			 */
			const productFavoriteEl = document.createElement('div');
			productFavoriteEl.classList.add('product__favorited');
			productFavoriteEl.innerHTML = `
					<svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 256 256">
						<g fill="#888888">
							<path class="heart-inner" d="M217.36 133.36L128 224l-89.36-90.64a50 50 0 0 1 70.72-70.72L128 80l18.64-17.36a50 50 0 1 1 70.72 70.72Z" />
							<path class="heart-outer" d="M223 57a58.07 58.07 0 0 0-81.92-.1L128 69.05l-13.09-12.19A58 58 0 0 0 33 139l89.35 90.66a8 8 0 0 0 11.4 0L223 139a58 58 0 0 0 0-82Zm-11.35 70.76L128 212.6l-83.7-84.92a42 42 0 0 1 59.4-59.4l.2.2l18.65 17.35a8 8 0 0 0 10.9 0l18.65-17.35l.2-.2a42 42 0 1 1 59.36 59.44Z"/>
						</g>
					</svg>
				`;

			return productFavoriteEl;
		}

		function createProductPriceWrapperEl() {
			const productPriceWrapperEl = document.createElement('div');
			productPriceWrapperEl.classList.add('product__price');

			return productPriceWrapperEl;
		}

		function createProductPriceLabelEl() {
			const productPriceLabelEl = document.createElement('span');
			productPriceLabelEl.classList.add('price__label');
			productPriceLabelEl.innerText = 'Price: ';

			return productPriceLabelEl;
		}

		function createProductPriceEl(price) {
			const formattedPrice = formatPrice(price);
			const productPriceEl = document.createElement('span');
			productPriceEl.classList.add('price__value--list-price');
			productPriceEl.innerText = formattedPrice;

			return productPriceEl;
		}

		function createProductSalePriceEl(salePrice) {
			const formattedPrice = formatPrice(salePrice);
			const productSalePriceEl = document.createElement('span');
			productSalePriceEl.classList.add('price__value--sale-price');
			productSalePriceEl.innerText = formattedPrice;

			return productSalePriceEl;
		}

		function buildCategoryAndAppendToList(products, category, categoryListEl) {
			const categoryListItemEl = createCategoryListItemEl();
			const categoryButtonEl = createCategoryButtonEl();
			const categoryHeaderEl = createCategoryHeaderEl(category);
			const productListEl = createProductListEl(category);

			categoryListItemEl.appendChild(categoryButtonEl);
			categoryButtonEl.appendChild(categoryHeaderEl);
			categoryButtonEl.appendChild(productListEl);

			products
				.map(addIsFavoritedProperty)
				.forEach((product) => buildProductAndAppendToList(product, productListEl));

			categoryListEl.appendChild(categoryListItemEl);
		}

		function addIsFavoritedProperty(product) {
			const favoritedProductIds = getFavoritedProductIds();

			return {
				...product,
				isFavorited: favoritedProductIds.includes(product.id)
			}
		}

		function buildProductAndAppendToList(productData, categoryListItemEl) {
			const { id, name, price, salePrice, isFavorited } = productData;

			const productListItemEl = createProductListItemEl(id, isFavorited);
			const productButtonEl = createProductButtonEl();
			const productHeaderEl = createProductHeaderEl(name);
			const productFavoriteEl = createProductFavoriteEl();
			const productPriceWrapperEl = createProductPriceWrapperEl();
			const productPriceLabelEl = createProductPriceLabelEl();
			const productPriceEl = createProductPriceEl(price);
			const productSalePriceEl = createProductSalePriceEl(salePrice);

			productPriceWrapperEl.appendChild(productPriceLabelEl);
			productPriceWrapperEl.appendChild(productPriceEl);
			productPriceWrapperEl.appendChild(productSalePriceEl);

			productButtonEl.appendChild(productFavoriteEl);
			productButtonEl.appendChild(productHeaderEl);
			productButtonEl.appendChild(productPriceWrapperEl);

			productListItemEl.appendChild(productButtonEl);
			categoryListItemEl.appendChild(productListItemEl);
		}

		function categoryClickHandler(e) {
			const isExpanded = e.currentTarget.parentNode.getAttribute('aria-expanded');
			e.currentTarget.parentNode.setAttribute('aria-expanded', isExpanded === 'true' ? 'false' : 'true');
		}

		function productClickHandler(e) {
			e.stopPropagation();
			const id = e.currentTarget.parentNode.getAttribute('data-id');
			const isFavorited = e.currentTarget.parentNode.getAttribute('data-favorited') === 'true';
			const newValue = isFavorited ? 'false' : 'true';
			e.currentTarget.parentNode.setAttribute('data-favorited', newValue);

			const favoritedProductIds = getFavoritedProductIds();
			setFavoritedProductIds(
				newValue === 'true'
					? [...favoritedProductIds, id]
					: favoritedProductIds.filter((val) => val !== id)
			);
		}

		function formatPrice(price) {
			return isNaN(price)
				? 'N/A'
				: price.toFixed(2);
		}

		function getFavoritedProductIds() {
			const favoritedProductIds = localStorage.getItem('favoritedProductIds');

			return favoritedProductIds ? JSON.parse(favoritedProductIds) : [];
		}

		function setFavoritedProductIds(favoritedProductIds) {
			localStorage.setItem('favoritedProductIds', JSON.stringify(favoritedProductIds));
		}
	</script>
</body>

</html>